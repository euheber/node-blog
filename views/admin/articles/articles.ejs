<!DOCTYPE html>
<html lang="pt-br">
  <%- include('../../partials/head') %>
  <body>
    <%- include('../../partials/header') %>
    <main class="container">
      <h1 class="fs-2">Artigos</h1>
      <a class="btn btn-primary" href="/admin/articles/new"
        >Criar novo artigo</a
      >

      <section class="mt-3">
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>ID</th>
              <th>Título</th>
              <th>Slug</th>
              <th>Categoria</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
              <% articles.forEach(article => { %>
                <tr>
                  <td><%= article.id %></td>
                  <td><%= article.title %></td>
                  <td><%= article.slug %></td>
                  <td><%= article.Category.title %></td>
                  <td>
                    <form method="POST" action="/articles/delete"  onsubmit="handleArticleDelete(event, this)">
                      <button class="btn btn-danger">Apagar</button>
                      <input type="hidden" value="<%= article.id %>" name="id">
                    </form>
                  </td>
                </tr>
              <% }) %>
          </tbody>
        </table>
      </section>
    </main>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
      crossorigin="anonymous"
    ></script>
    <script>
      const handleArticleDelete = (e, form) => { 
        e.preventDefault()

        confirm("Você quer deletar este artigo?") ? form.submit() : ""
      }
    </script>
  </body>
</html>
